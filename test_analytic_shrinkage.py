import numpy as np
import analytic_shrinkage


def test_analytic_shrinkage():
    x = np.array([[-0.98511153, -0.2599713],
                  [0.20374114, -0.59699234],
                  [0.28570754, 0.77542166],
                  [-0.78768299, 0.45808448],
                  [0.80494623, -2.16308943],
                  [-2.01761751, -0.27944538],
                  [-0.24710646, -0.33260174],
                  [0.369508, 0.57123535],
                  [2.07913481, -0.0749686],
                  [1.07194672, -0.69343179],
                  [-0.11947645, -1.45457297],
                  [-0.54877366, -1.21191041]])

    expected = np.array([[1.04344299, 0.0335051],
                         [0.0335051, 1.11112703]])

    sigma_tilde = analytic_shrinkage.analytic_shrinkage(x)

    np.testing.assert_allclose(sigma_tilde, expected)


def test_large_p():
    x = np.array([[-0.83171509, 1.21042202, -0.64476685, 1.74247048, -1.28745695,
                   1.22673904, -0.27948581, -0.35353858, 0.48460749, -0.23206148,
                   1.43578483, -0.03127308],
                  [1.2147889, 0.29991525, -1.25811966, 0.83696992, 0.10132243,
                   1.52429587, 1.11155316, 0.858513, -1.38837667, -0.36513517,
                   -1.32908941, 0.20165299],
                  [0.35388015, -0.83998576, 0.39780027, 0.73931657, 0.02249167,
                   0.80457532, -0.68438554, 1.10234674, 0.04978513, -0.4199404,
                   0.59557688, -0.07514737],
                  [0.2029107, -0.23240219, 0.22168354, 0.39515967, 0.18159286,
                   1.71358639, 1.12223573, 0.73257645, -0.78705894, 0.20671081,
                   -0.44116057, 0.81145095],
                  [2.20373632, 1.66547244, 0.23480935, -1.53614472, -0.61683836,
                   -0.46993418, -1.147855, -0.64288828, -0.44359208, 0.18481153,
                   0.2175085, -1.62251995],
                  [-1.10319827, 0.97096499, 1.74044517, 1.67528969, 0.0955992,
                   -1.40389223, 0.4176328, 1.59105526, 0.63004868, 1.82129757,
                   1.01188612, -0.74266853],
                  [-0.24662301, -0.53711279, -0.33514023, 1.3298531, 1.25077656,
                   -0.77572193, 0.97644005, -0.69008228, -0.82704914, -0.24803761,
                   -0.32382706, -0.81257239],
                  [0.72319293, -2.45019062, -1.67746125, 0.88117342, -0.48139636,
                   2.67937439, 1.76346012, -0.48753695, -0.14620455, 0.36842804,
                   0.09277587, -1.51204032],
                  [-1.21388644, -0.95005377, -0.3785377, 0.52808142, -0.29726782,
                   -0.82562988, -0.59907897, 1.01931651, -0.2072882, -2.3094193,
                   0.33119756, -0.10369929],
                  [-1.38220914, -1.32281914, -0.71570525, -1.64038715, -0.58456167,
                   1.4717484, -1.16122503, 0.21292358, -1.34329045, -0.21629515,
                   0.43242334, 1.2815689],
                  [-0.64686444, -0.06063199, 0.8763753, 0.09410063, 0.9895837,
                   0.53509127, -0.86369022, 0.98846497, 0.20976512, 1.00162879,
                   0.11897461, 1.02380226],
                  [0.93626358, -0.36553413, -0.06897691, 1.60685386, -0.59050774,
                   -1.18229907, -0.59371313, -0.3071166, -0.91861304, 0.12723249,
                   0.69705154, 0.74121609]])
    expected = np.array([[0.70977551, 0.02035828, 0.12879925, 0.29999127, -0.02721,
                          -0.06085516, 0.12065067, 0.04346693, 0.01633469, 0.17084537,
                          -0.03486324, -0.17737681],
                         [0.02035828, 0.68886068, -0.08990423, 0.14634085, -0.04949744,
                          0.31894603, 0.146555, -0.02856172, 0.01772622, 0.04622501,
                          -0.06145598, -0.07206096],
                         [0.12879925, -0.08990423, 0.51960429, -0.16823701, 0.11531592,
                          0.21373646, 0.15655766, 0.08525796, -0.07092926, 0.01396501,
                          0.07580504, 0.06353573],
                         [0.29999127, 0.14634085, -0.16823701, 0.38806985, -0.00725625,
                          -0.10476381, -0.07080926, -0.23524785, -0.05038355, -0.08872593,
                          0.06127814, -0.11986417],
                         [-0.02721, -0.04949744, 0.11531592, -0.00725625, 0.84921271,
                          0.04001091, -0.0577046, -0.0701174, -0.09716767, 0.02075353,
                          -0.30659513, -0.0528763],
                         [-0.06085516, 0.31894603, 0.21373646, -0.10476381, 0.04001091,
                          0.5993304, -0.17914616, 0.10424422, 0.1386708, 0.18064931,
                          0.17850609, 0.03361069],
                         [0.12065067, 0.146555, 0.15655766, -0.07080926, -0.0577046,
                          -0.17914616, 0.71253504, -0.10229201, 0.0339314, 0.07458065,
                          -0.26771284, -0.0879245],
                         [0.04346693, -0.02856172, 0.08525796, -0.23524785, -0.0701174,
                          0.10424422, -0.10229201, 0.77143929, -0.0013671, -0.04018016,
                          -0.18347344, -0.02558338],
                         [0.01633469, 0.01772622, -0.07092926, -0.05038355, -0.09716767,
                          0.1386708, 0.0339314, -0.0013671, 0.62340055, -0.01575242,
                          -0.04872867, -0.06846099],
                         [0.17084537, 0.04622501, 0.01396501, -0.08872593, 0.02075353,
                          0.18064931, 0.07458065, -0.04018016, -0.01575242, 0.94260731,
                          -0.03317596, 0.06477798],
                         [-0.03486324, -0.06145598, 0.07580504, 0.06127814, -0.30659513,
                          0.17850609, -0.26771284, -0.18347344, -0.04872867, -0.03317596,
                          0.50340006, -0.10278294],
                         [-0.17737681, -0.07206096, 0.06353573, -0.11986417, -0.0528763,
                          0.03361069, -0.0879245, -0.02558338, -0.06846099, 0.06477798,
                          -0.10278294, 0.88454544]])

    sigma_tilde = analytic_shrinkage.analytic_shrinkage(x)
    np.testing.assert_allclose(sigma_tilde, expected, rtol=1e-5)
